name: Setup environment
description: Setup development environment
# inputs:
#   who-to-greet:  # id of input
#     description: 'Who to greet'
#     required: true
#     default: 'World'
# outputs:
#   random-number:
#     description: "Random number"
#     value: ${{ steps.random-number-generator.outputs.random-id }}
runs:
  using: "composite"
  steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    # See: https://github.com/marketplace/actions/setup-conda
    - name: Setup anaconda
      uses: s-weigand/setup-conda@v1
      with:
        conda-channels: "conda-forge"

    # Build cache of environment
    - name: Cache conda environment
      id: cache-environment
      uses: actions/cache@v2
      # Conda environment build step depends on two files,
      # so we ensure that the hash key contains both their hashes.
      with:
        path: |
          seqlike-dev.tar.gz
        key: ${{ runner.os }}-env.${{ hashFiles('environment.yml') }}

    - name: Build environment
      if: steps.cache-environment.outputs.cache-hit != 'true'
      run: |
        conda env create -f environment.yml
        python -m pip install .
